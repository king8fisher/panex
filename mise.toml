[tools]
node = "22"
rust = "latest"
zig = "latest"

[tasks.current-version]
run = ["npm view panex version"]

[tasks.release]
description = "Create and push a release tag. Usage: mise run release 1.0.0"
run = """
#!/usr/bin/env bash
set -e
VERSION="$1"
if [ -z "$VERSION" ]; then
  echo "Usage: mise run release <version>"
  echo "Example: mise run release 1.0.0"
  exit 1
fi
echo "Creating release v$VERSION..."
git tag -a "v$VERSION" -m "Release v$VERSION"
git push origin "v$VERSION"
echo "Done! Watch the release at: https://github.com/king8fisher/panex/actions"
"""

[tasks.build]
dir = "panex-rs"
run = "cargo build --release"

[tasks.build-fire]
dir = "scripts"
run = "zig build-exe fire.zig -O ReleaseFast"

[tasks.dev]
wait_for = ["build", "build-fire"]
dir = "panex-rs"
run = """
cargo run -- \
  "mise x fastfetch -- fastfetch" \
  "mise x fastfetch -- fastfetch" \
  "mise x bottom -- btm" \
  "mise x lazygit -- lazygit" \
  "mise x yazi -- yazi" \
  "mise x glow -- glow ../README.md" \
  "mise x gitui -- gitui" \
  "mise x gum -- gum spin --spinner dot --title 'Loading...' -- sleep 100" \
  "mise x cowsay -- cowsay 'Hello from panex!'" \
  "mise build-fire && ../scripts/fire hash" \
  -n fastfetch,fastfetch:w,bottom,lazygit,yazi,glow,gitui,gum-spinner,cowsay,fire
"""
